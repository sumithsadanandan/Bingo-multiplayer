
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sumithâ€™s Bingo</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{
  --bg:#fde2e4;
  --card:#fff;
  --marked:#e6dbff;
  --complete:#c8f7dc;
  --accent:#ec407a;
  --text:#444;
}
body{
  margin:0;
  font-family:Poppins,sans-serif;
  background:var(--bg);
  display:flex;
  justify-content:center;
}
body.neon{
  --bg:#0f2027;
  --card:#111;
  --marked:#7c4dff;
  --complete:#00e676;
  --accent:#00e5ff;
  --text:#e0f7fa;
}
body.soft{
  --bg:#e0e0e0;
  --card:#e0e0e0;
  --marked:#d1c4e9;
  --complete:#b2dfdb;
  --accent:#757575;
  --text:#333;
}
.app{width:100%;max-width:420px;padding:16px;}
header{display:flex;justify-content:space-between;align-items:center;}
h1{margin:0;color:var(--text);}
select{border-radius:10px;padding:6px;}

.card{
  background:var(--card);
  border-radius:20px;
  padding:16px;
  margin-top:12px;
}
button{
  padding:10px 20px;
  border-radius:20px;
  border:none;
  background:var(--accent);
  color:#fff;
  font-size:16px;
}
input{
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  width:100%;
  margin-bottom:10px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:10px;
}
.cell{
  aspect-ratio:1;
  border-radius:14px;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
  cursor:pointer;
}
.cell.marked{background:var(--marked);}
.cell.completed{background:var(--complete);}

.bingo{
  display:flex;
  justify-content:center;
  gap:10px;
  margin:10px 0;
}
.letter{
  width:36px;height:36px;
  border-radius:50%;
  border:2px solid var(--accent);
  display:flex;
  align-items:center;
  justify-content:center;
}
.letter.active{
  background:var(--accent);
  color:#fff;
}
#bingoMessage{
  text-align:center;
  font-size:26px;
  display:none;
}
.hidden{display:none;}
</style>
</head>

<body class="pastel">
<div class="app">

<header>
  <h1>Sumithâ€™s Bingo</h1>
  <select id="theme">
    <option value="pastel">ðŸŒ¸ Pastel</option>
    <option value="neon">âš¡ Neon</option>
    <option value="soft">ðŸ§Š Soft</option>
  </select>
</header>

<!-- LOBBY -->
<div class="card" id="lobby">
  <button onclick="createRoom()">Create Room</button>
  <hr/>
  <input id="roomInput" placeholder="Enter room code"/>
  <button onclick="joinRoom()">Join Room</button>
  <p id="lobbyStatus"></p>
  <button id="startBtn" class="hidden" onclick="startGame()">Start Game</button>
</div>

<!-- GAME -->
<div id="game" class="hidden">
  <div class="bingo">
    <div class="letter" id="b">B</div>
    <div class="letter" id="i">I</div>
    <div class="letter" id="n">N</div>
    <div class="letter" id="g">G</div>
    <div class="letter" id="o">O</div>
  </div>

  <div class="card">
    <div class="grid" id="grid"></div>
  </div>

  <div id="bingoMessage">ðŸŽ‰ BINGO ðŸŽ‰</div>
</div>

</div>

<script>
/* ðŸ”¥ FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyCKZ-ktAV8MPyZbjwkuzszTUEzHXvoKOGA",
  authDomain: "bingo-multiplayer-315fb.firebaseapp.com",
  databaseURL: "https://bingo-multiplayer-315fb-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "bingo-multiplayer-315fb",
  storageBucket: "bingo-multiplayer-315fb.firebasestorage.app",
  messagingSenderId: "157740745674",
  appId: "1:157740745674:web:a4bdabb3bc8a05d024c533",
  measurementId: "G-88SZ629W0B"
});
const db=firebase.database();

/* GAME STATE */
const SIZE=5;
let roomCode,playerNum,roomRef;
let cells=[],completed=new Set(),bingo=false;

/* THEME */
theme.onchange=e=>document.body.className=e.target.value;

/* CREATE ROOM */
function createRoom(){
  roomCode=Math.random().toString(36).substring(2,7).toUpperCase();
  playerNum=1;
  roomRef=db.ref("rooms/"+roomCode);
  roomRef.set({
    players:1,
    started:false,
    currentPlayer:1,
    calledNumbers:[],
    boards:{p1:genBoard()}
  });
  listenLobby();
}

/* JOIN ROOM */
function joinRoom(){
  roomCode=roomInput.value.trim().toUpperCase();
  roomRef=db.ref("rooms/"+roomCode);
  roomRef.once("value",s=>{
    if(!s.exists()) return alert("Room not found");
    const d=s.val();
    if(d.players>=2) return alert("Room full");
    playerNum=2;
    roomRef.update({
      players:2,
      boards:{...d.boards,p2:genBoard()}
    });
    listenLobby();
  });
}

/* LOBBY LISTENER */
function listenLobby(){
  roomRef.on("value",s=>{
    const d=s.val();
    lobbyStatus.innerText=`Room: ${roomCode} | Players: ${d.players}/2`;

    if(d.players===2 && playerNum===1 && !d.started){
      startBtn.classList.remove("hidden");
    } else {
      startBtn.classList.add("hidden");
    }

    if(d.players===2 && playerNum===2 && !d.started){
      lobbyStatus.innerText="Waiting for host to startâ€¦";
    }

    if(d.started) enterGame(d);
  });
}

/* START GAME */
function startGame(){
  if(playerNum!==1) return;
  roomRef.update({started:true});
}

/* ENTER GAME */
function enterGame(d){
  lobby.classList.add("hidden");
  game.classList.remove("hidden");
  const board=d.boards[playerNum===1?"p1":"p2"];
  renderBoard(board);
  listenGame();
}

/* BOARD */
function genBoard(){
  return [...Array(25).keys()].map(i=>i+1).sort(()=>Math.random()-0.5);
}
function renderBoard(nums){
  grid.innerHTML='';
  cells=[];
  completed.clear();
  bingo=false;
  nums.forEach(n=>{
    const c=document.createElement("div");
    c.className="cell";
    c.textContent=n;
    c.onclick=()=>cellClick(n);
    cells.push(c);
    grid.appendChild(c);
  });
}

/* CLICK HANDLER (TURN SAFE) */
function cellClick(n){
  roomRef.once("value",s=>{
    const d=s.val();
    if(d.currentPlayer!==playerNum){
      alert("Not your turn");
      return;
    }
    if(d.calledNumbers.includes(n)) return;

    roomRef.update({
      calledNumbers:[...d.calledNumbers,n],
      currentPlayer:playerNum===1?2:1
    });
  });
}

/* GAME LISTENER */
function listenGame(){
  roomRef.on("value",s=>{
    const d=s.val();
    updateBoard(d.calledNumbers);
    lobbyStatus.innerText=
      d.currentPlayer===playerNum?"Your turn":"Opponentâ€™s turn";
  });
}

/* BINGO LOGIC (OFFLINE GOLD STANDARD) */
function updateBoard(called){
  completed.clear();

  cells.forEach(c=>{
    c.classList.remove("marked","completed");
    if(called.includes(+c.textContent)) c.classList.add("marked");
  });

  const lines=[];
  for(let r=0;r<5;r++) lines.push([...Array(5)].map((_,c)=>r*5+c));
  for(let c=0;c<5;c++) lines.push([...Array(5)].map((_,r)=>r*5+c));

  lines.forEach((l,i)=>{
    if(l.every(x=>cells[x].classList.contains("marked"))){
      l.forEach(x=>cells[x].classList.add("completed"));
      completed.add(i);
    }
  });

  ["b","i","n","g","o"].forEach((id,i)=>{
    document.getElementById(id)
      .classList.toggle("active",completed.size>i);
  });

  if(completed.size>=5 && !bingo){
    bingo=true;
    bingoMessage.style.display="block";
  }
}
</script>
</body>
</html>

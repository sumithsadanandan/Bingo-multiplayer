<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sumithâ€™s Bingo</title>

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #f6f4ff;
}
header {
  text-align: center;
  padding: 12px;
  font-size: 22px;
  font-weight: bold;
}
.container {
  max-width: 420px;
  margin: auto;
  padding: 10px;
}
.card {
  background: white;
  padding: 14px;
  border-radius: 14px;
  box-shadow: 0 6px 16px rgba(0,0,0,.08);
}
button, input {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  font-size: 16px;
}
.grid {
  display: grid;
  grid-template-columns: repeat(5,1fr);
  gap: 6px;
  margin-top: 12px;
}
.cell {
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #ecebff;
  border-radius: 8px;
  font-weight: 600;
  font-size: 18px;
}
.cell.marked { background: #b8f2c2; }
.cell.line { background: #ffd8a8; }
.hidden { display:none; }
.status { text-align:center; margin-top:8px; font-weight:600; }
</style>
</head>

<body>
<header>ðŸŽ‰ Sumithâ€™s Bingo ðŸŽ‰</header>

<div class="container">

<div id="lobby" class="card">
  <button onclick="createRoom()">Create Room</button>
  <input id="roomInput" placeholder="Enter Room Code"/>
  <button onclick="joinRoom()">Join Room</button>
</div>

<div id="game" class="card hidden">
  <div class="status" id="roomText"></div>
  <div class="status" id="turnText"></div>
  <button id="startBtn" class="hidden" onclick="startGame()">Start Game</button>
  <div class="grid" id="board"></div>
  <div class="status" id="bingoText"></div>
</div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCKZ-ktAV8MPyZbjwkuzszTUEzHXvoKOGA",
  authDomain: "bingo-multiplayer-315fb.firebaseapp.com",
  databaseURL: "https://bingo-multiplayer-315fb-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "bingo-multiplayer-315fb",
  storageBucket: "bingo-multiplayer-315fb.firebasestorage.app",
  messagingSenderId: "157740745674",
  appId: "1:157740745674:web:a4bdabb3bc8a05d024c533",
  measurementId: "G-88SZ629W0B"
});

const db = firebase.database();

let roomId, playerId, isOwner = false;
let board = [];
let marked = Array(25).fill(false);
let completedLines = new Set();

/* ---------- LOBBY ---------- */
function createRoom() {
  roomId = Math.random().toString(36).substring(2,7).toUpperCase();
  playerId = "P1";
  isOwner = true;

  db.ref("rooms/"+roomId).set({
    players: { P1:true },
    started:false,
    turn:"P1"
  });

  enterRoom();
}

function joinRoom() {
  roomId = roomInput.value.trim().toUpperCase();
  if (!roomId) return;
  playerId = "P2";
  db.ref("rooms/"+roomId+"/players/P2").set(true);
  enterRoom();
}

function enterRoom() {
  lobby.classList.add("hidden");
  game.classList.remove("hidden");
  roomText.innerText = "Room: " + roomId;
  listenRoom();
}

/* ---------- GAME ---------- */
function startGame() {
  const boardData = shuffle([...Array(25).keys()].map(n=>n+1));
  db.ref(`rooms/${roomId}/boards/${playerId}`).set(boardData);
  db.ref(`rooms/${roomId}/started`).set(true);
}

function listenRoom() {
  db.ref("rooms/"+roomId).on("value", snap => {
    const d = snap.val();
    if (!d) return;

    const players = Object.keys(d.players||{});
    turnText.innerText = "Turn: " + d.turn;

    if (isOwner && players.length===2 && !d.started)
      startBtn.classList.remove("hidden");

    if (d.started && d.boards?.[playerId]) {
      board = d.boards[playerId];
      renderBoard(d.marks||{}, d.turn);
    }
  });
}

function renderBoard(marks, turn) {
  boardDiv.innerHTML="";
  marked.fill(false);

  Object.keys(marks||{}).forEach(i=>marked[i]=true);

  board.forEach((n,i)=>{
    const c=document.createElement("div");
    c.className="cell";
    if(marked[i]) c.classList.add("marked");
    c.innerText=n;
    c.onclick=()=>clickCell(i,turn,marks);
    boardDiv.appendChild(c);
  });

  checkBingo();
}

function clickCell(i,turn,marks) {
  if (turn!==playerId || marks?.[i]) return;
  db.ref(`rooms/${roomId}/marks/${i}`).set(true);
  db.ref(`rooms/${roomId}/turn`).set(playerId==="P1"?"P2":"P1");
}

/* ---------- BINGO LOGIC ---------- */
function checkBingo() {
  let count=0;

  const checkLine = idxs => idxs.every(i=>marked[i]);

  for(let r=0;r<5;r++){
    const line=`R${r}`;
    if(!completedLines.has(line) && checkLine([0,1,2,3,4].map(c=>r*5+c))){
      completedLines.add(line); count++;
    }
  }

  for(let c=0;c<5;c++){
    const line=`C${c}`;
    if(!completedLines.has(line) && checkLine([0,1,2,3,4].map(r=>r*5+c))){
      completedLines.add(line); count++;
    }
  }

  const letters="BINGO";
  bingoText.innerText=letters.slice(0,completedLines.size);
  if(completedLines.size>=5) bingoText.innerText="ðŸŽ‰ BINGO! ðŸŽ‰";
}

/* ---------- UTILS ---------- */
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

const boardDiv=document.getElementById("board");
</script>
</body>
</html>

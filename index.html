<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sumithâ€™s Bingo</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: linear-gradient(135deg, #fde2e4, #fadadd);
  --card: #ffffff;
  --cell: #ffffff;
  --border: #e8e8e8;
  --marked: #e6dbff;
  --complete: #c8f7dc;
  --accent: #f48fb1;
  --accent-dark: #ec407a;
  --text: #444;
  --shadow: 0 12px 30px rgba(0,0,0,0.08);
}
body {margin:0;font-family:'Poppins',sans-serif;min-height:100vh;display:flex;justify-content:center;background:var(--bg);}
.app {width:100%;max-width:420px;padding:16px;}
header {display:flex;justify-content:space-between;align-items:center;}
h1 {margin:6px 0;color:var(--text);}
select {padding:6px 10px;border-radius:12px;border:none;font-family:inherit;}
.bingo {display:flex;justify-content:center;gap:10px;margin:12px 0;}
.letter {width:44px;height:44px;border-radius:50%;background:#fff;border:2px solid var(--accent);display:flex;align-items:center;justify-content:center;font-weight:600;color:var(--accent);}
.letter.active {background:linear-gradient(135deg,var(--accent),var(--accent-dark));color:#fff;}
.card {background:var(--card);border-radius:20px;padding:14px;box-shadow:var(--shadow);}
.grid {display:grid;grid-template-columns:repeat(5,1fr);gap:10px;}
.cell {aspect-ratio:1;background:var(--cell);border-radius:14px;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:600;color:var(--text);cursor:pointer;transition:0.25s;}
.cell.marked {background: var(--marked);}
.cell.completed {background: var(--complete);}
.controls {text-align:center;margin-top:14px;}
button {padding:12px 24px;font-size:16px;border-radius:30px;border:none;background:linear-gradient(135deg,var(--accent),var(--accent-dark));color:#fff;cursor:pointer;}
#bingoMessage {margin-top:12px;font-size:26px;font-weight:600;color:var(--accent-dark);opacity:0;transition:0.6s;}
#bingoMessage.show {opacity:1;}
canvas {position:fixed;inset:0;pointer-events:none;}
</style>
</head>
<body class="pastel">
<div class="app">
  <header>
    <h1>Sumithâ€™s Bingo</h1>
    <select id="theme">
      <option value="pastel">ðŸŒ¸ Pastel Play</option>
      <option value="neon">âš¡ Neon Night</option>
      <option value="soft">ðŸ§Š Soft Touch</option>
    </select>
  </header>

  <div id="roomSetup">
    <button id="createRoomBtn">Create Room</button>
    <input type="text" id="joinCode" placeholder="Enter Room Code">
    <button id="joinRoomBtn">Join Room</button>
  </div>

  <div id="gameArea" class="hidden">
    <div class="bingo">
      <div class="letter" id="b">B</div>
      <div class="letter" id="i">I</div>
      <div class="letter" id="n">N</div>
      <div class="letter" id="g">G</div>
      <div class="letter" id="o">O</div>
    </div>

    <div class="card">
      <div class="grid" id="grid"></div>
    </div>

    <div class="controls">
      <button id="newGameBtn">New Board</button>
      <div id="bingoMessage">ðŸŽ‰ BINGO! ðŸŽ‰</div>
      <div id="turnIndicator"></div>
      <div id="calledNumbers"></div>
    </div>
  </div>
</div>

<audio id="sound" src="sound-effect-bingo-122339.mp3"></audio>
<canvas id="confetti"></canvas>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCKZ-ktAV8MPyZbjwkuzszTUEzHXvoKOGA",
  authDomain: "bingo-multiplayer-315fb.firebaseapp.com",
  databaseURL: "https://bingo-multiplayer-315fb-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "bingo-multiplayer-315fb",
  storageBucket: "bingo-multiplayer-315fb.firebasestorage.app",
  messagingSenderId: "157740745674",
  appId: "1:157740745674:web:a4bdabb3bc8a05d024c533",
  measurementId: "G-88SZ629W0B"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const SIZE = 5;
let cells=[], completed=new Set(), bingo=false, audioReady=false, completedLines=0;
let playerNum, roomCode;
const sound = document.getElementById('sound');
sound.volume=1;

document.getElementById('theme').onchange = e => {document.body.className = e.target.value;};

// --- Room setup ---
document.getElementById('createRoomBtn').onclick = ()=>{
  roomCode=Math.random().toString(36).substring(2,7).toUpperCase();
  playerNum=1;
  const board1=generateBoard(), board2=generateBoard();
  db.ref('rooms/'+roomCode).set({calledNumbers:[], board1, board2, players:{'1':true}, currentPlayer:1});
  startGame();
};
document.getElementById('joinRoomBtn').onclick = ()=>{
  const code=document.getElementById('joinCode').value.trim().toUpperCase();
  if(!code) return alert("Enter room code");
  db.ref('rooms/'+code).once('value').then(s=>{
    if(!s.exists()) return alert("Room not found");
    roomCode=code; playerNum=2;
    db.ref('rooms/'+roomCode+'/players/2').set(true);
    startGame();
  });
};

// --- Generate board offline style ---
function generateBoard(){return [...Array(25).keys()].map(i=>i+1).sort(()=>Math.random()-0.5);}
function populateGrid(){
  const grid=document.getElementById('grid');
  grid.innerHTML=''; cells.length=0; completed.clear(); bingo=false; completedLines=0;
  document.getElementById('bingoMessage').classList.remove('show');
  [...Array(25).keys()].map(i=>i+1).sort(()=>Math.random()-0.5).forEach(n=>{
    const cell=document.createElement('div');
    cell.className='cell'; cell.textContent=n;
    cell.onclick = ()=>{
      if(!audioReady){sound.play().catch(()=>{});sound.pause();audioReady=true;}
      // --- Firebase logic ---
      db.ref('rooms/'+roomCode).once('value').then(s=>{
        const data=s.val(); if(!data) return;
        if(data.currentPlayer!==playerNum) return;
        const called = (data.calledNumbers||[]).map(Number);
        if(!called.includes(Number(n))){
          db.ref('rooms/'+roomCode).update({
            calledNumbers:[...called,Number(n)],
            currentPlayer:playerNum===1?2:1
          });
        }
      });
    };
    cells.push(cell); grid.appendChild(cell);
  });
}

// --- Game start ---
function startGame(){
  document.getElementById('roomSetup').classList.add('hidden');
  document.getElementById('gameArea').classList.remove('hidden');
  db.ref('rooms/'+roomCode).on('value', snapshot=>{
    const data=snapshot.val(); if(!data) return;
    const boardKey = playerNum===1?'board1':'board2';
    if(cells.length===0 || JSON.stringify(data[boardKey])!==JSON.stringify(cells.map(c=>Number(c.textContent)))){
      populateGrid();
      // Update numbers to match server
      const nums=data[boardKey]; cells.forEach((c,i)=>c.textContent=nums[i]);
    }

    // Update called numbers
    const calledNumbers = (data.calledNumbers||[]).map(Number);
    document.getElementById('calledNumbers').textContent="Called: "+calledNumbers.join(', ');

    // Turn indicator
    const playerCount = data.players?Object.keys(data.players).length:0;
    if(playerCount<2) document.getElementById('turnIndicator').textContent="Waiting for second player...";
    else document.getElementById('turnIndicator').textContent= data.currentPlayer===playerNum?"Your turn":"Opponent's turn";

    highlightCompletedLines(calledNumbers);
  });
}

// --- Highlight and Bingo logic (offline style) ---
function highlightCompletedLines(calledNumbers){
  const lines=[];
  for(let r=0;r<SIZE;r++) lines.push([...Array(SIZE)].map((_,c)=>r*SIZE+c));
  for(let c=0;c<SIZE;c++) lines.push([...Array(SIZE)].map((_,r)=>r*SIZE+c));
  let currentCompleted=0;
  lines.forEach((l,i)=>{
    if(l.every(x=>calledNumbers.includes(Number(cells[x].textContent)))){
      l.forEach(x=>cells[x].classList.add('completed'));
      completed.add(i);
      currentCompleted++;
    } else {
      l.forEach(x=>{
        if(calledNumbers.includes(Number(cells[x].textContent))) cells[x].classList.add('marked');
      });
    }
  });

  ['b','i','n','g','o'].forEach((id,i)=>{document.getElementById(id).classList.toggle('active', completed.size>i);});

  if(completed.size>=5 && !bingo){
    bingo=true;
    document.getElementById('bingoMessage').classList.add('show');
    sound.currentTime=0; sound.play().catch(()=>{});
    confetti();
  }
}

// --- New board ---
document.getElementById('newGameBtn').onclick=()=>{
  const board1=generateBoard(), board2=generateBoard();
  db.ref('rooms/'+roomCode).update({calledNumbers:[], board1, board2, currentPlayer:1});
  bingo=false; completed.clear(); completedLines=0;
  document.getElementById('bingoMessage').classList.remove('show');
};

// --- Confetti ---
let confettiFrameId=null;
function confetti(){
  const c=document.getElementById('confetti'); const ctx=c.getContext('2d');
  c.width=innerWidth; c.height=innerHeight;
  const pieces=[...Array(120)].map(()=>({x:Math.random()*c.width,y:-20,r:Math.random()*6+4,v:Math.random()*3+2,col:['#f48fb1','#ce93d8','#b39ddb','#80cbc4','#a5d6a7'][Math.floor(Math.random()*5)]}));
  let frame=0;
  function draw(){
    ctx.clearRect(0,0,c.width,c.height);
    pieces.forEach(p=>{p.y+=p.v;ctx.fillStyle=p.col;ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();});
    if(frame++<180) confettiFrameId=requestAnimationFrame(draw); else stopConfetti();
  }
  draw();
}
function stopConfetti(){if(confettiFrameId){cancelAnimationFrame(confettiFrameId);confettiFrameId=null;}
const c=document.getElementById('confetti');const ctx=c.getContext('2d');ctx.clearRect(0,0,c.width,c.height);}
</script>
</body>
</html>

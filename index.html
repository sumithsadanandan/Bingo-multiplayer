<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sumithâ€™s Bingo - Rooms</title>
<style>
body{margin:0;font-family:sans-serif;display:flex;flex-direction:column;align-items:center;padding:16px;background:#fde2e4;transition:0.3s;}
h1{margin:6px 0;}
input,button,select{padding:10px 16px;margin:5px;font-size:16px;border-radius:8px;border:1px solid #ccc;}
.board-container{display:flex;gap:16px;margin-top:16px;flex-wrap:wrap;}
.player-board{background:#fff;padding:20px;border-radius:20px;box-shadow:0 12px 24px rgba(0,0,0,0.12);text-align:center;transition:0.3s;}
.grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-top:12px;}
.cell{aspect-ratio:1;display:flex;justify-content:center;align-items:center;border-radius:16px;border:2px solid #e8e8e8;font-weight:700;font-size:18px;cursor:pointer;transition:0.25s;}
.cell.marked{background:#d0f0c0;} /* soft green */
.cell.completed{background:#4caf50;color:#fff;} /* completed row/column green */
#turnIndicator{margin-top:12px;font-weight:600;font-size:18px;}
canvas{position:fixed;inset:0;pointer-events:none;}
#winner{margin-top:12px;font-weight:700;font-size:20px;}
#calledNumbers{margin-top:12px;font-weight:500;}
.hidden{display:none;}
</style>
</head>
<body>

<h1>Sumithâ€™s Bingo</h1>

<div id="roomSetup">
  <button id="createRoomBtn">Create Room</button>
  <input type="text" id="joinCode" placeholder="Enter Room Code">
  <button id="joinRoomBtn">Join Room</button>
</div>

<div id="gameArea" class="hidden">
  <div>
    Room Code: <span id="roomCodeDisplay"></span>
    <select id="themeSelect">
      <option value="pastel">Pastel</option>
      <option value="lavender">Lavender</option>
      <option value="neon">Neon</option>
    </select>
    <button id="newGameBtn">New Game</button>
  </div>
  <div id="turnIndicator">Waiting for players...</div>
  <div id="calledNumbers"></div>

  <div class="board-container">
    <div class="player-board">
      <h2>Your Board</h2>
      <div class="grid" id="grid"></div>
      <div id="winner"></div>
    </div>
  </div>
</div>

<audio id="sound" src="sound-effect-bingo-122339.mp3"></audio>
<canvas id="confetti"></canvas>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ðŸ”¹ Replace with your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCKZ-ktAV8MPyZbjwkuzszTUEzHXvoKOGA",
  authDomain: "bingo-multiplayer-315fb.firebaseapp.com",
  databaseURL: "https://bingo-multiplayer-315fb-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "bingo-multiplayer-315fb",
  storageBucket: "bingo-multiplayer-315fb.firebasestorage.app",
  messagingSenderId: "157740745674",
  appId: "1:157740745674:web:a4bdabb3bc8a05d024c533",
  measurementId: "G-88SZ629W0B"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const SIZE=5;
let boardNums=[], cells=[], calledNumbers=[], bingo=false;
let playerNum, roomCode;

const grid=document.getElementById('grid');
const turnIndicator=document.getElementById('turnIndicator');
const calledNumbersDiv=document.getElementById('calledNumbers');
const sound=document.getElementById('sound');

const roomSetupDiv=document.getElementById('roomSetup');
const gameAreaDiv=document.getElementById('gameArea');
const roomCodeDisplay=document.getElementById('roomCodeDisplay');
const newGameBtn=document.getElementById('newGameBtn');
const themeSelect=document.getElementById('themeSelect');

function generateBoard(){return [...Array(25).keys()].map(i=>i+1).sort(()=>Math.random()-0.5);}

// Populate grid with clickable numbers
function populateGrid(){
  grid.innerHTML=''; cells.length=0;
  boardNums.forEach((n,i)=>{
    const cell=document.createElement('div');
    cell.className='cell';
    cell.textContent=n;

    cell.onclick = () => {
      if(bingo) return;
      db.ref('rooms/'+roomCode).once('value').then(snapshot=>{
        const data = snapshot.val(); if(!data) return;
        if(!data.calledNumbers.includes(n)){
          db.ref('rooms/'+roomCode).update({calledNumbers:[...data.calledNumbers,n]});
        }
      });
    };

    cells.push(cell);
    grid.appendChild(cell);
  });
}

// Theme application
function applyTheme(theme){
  if(theme==='pastel'){document.body.style.background='#fde2e4'; document.querySelector('.player-board').style.background='#fff'; document.querySelector('.player-board').style.color='#000';}
  if(theme==='lavender'){document.body.style.background='#e6e6fa'; document.querySelector('.player-board').style.background='#f5f0ff'; document.querySelector('.player-board').style.color='#000';}
  if(theme==='neon'){document.body.style.background='#000'; document.querySelector('.player-board').style.background='#111'; document.querySelector('.player-board').style.color='#0ff';}
}

// Room creation/join
document.getElementById('createRoomBtn').onclick=function(){
  roomCode=Math.random().toString(36).substring(2,7).toUpperCase();
  playerNum=1;
  const board1=generateBoard(); const board2=generateBoard();
  db.ref('rooms/'+roomCode).set({calledNumbers:[], board1, board2, players:{'1':true}});
  startGame();
};
document.getElementById('joinRoomBtn').onclick=function(){
  const code=document.getElementById('joinCode').value.trim().toUpperCase();
  if(!code) return alert("Enter room code");
  db.ref('rooms/'+code).once('value').then(snapshot=>{
    if(!snapshot.exists()) return alert("Room not found");
    roomCode=code; playerNum=2;
    db.ref('rooms/'+roomCode+'/players/2').set(true);
    startGame();
  });
};

function startGame(){
  roomSetupDiv.classList.add('hidden'); gameAreaDiv.classList.remove('hidden');
  roomCodeDisplay.textContent=roomCode;

  themeSelect.addEventListener('change',()=>applyTheme(themeSelect.value));
  applyTheme(themeSelect.value);

  db.ref('rooms/'+roomCode).on('value', snapshot=>{
    const data=snapshot.val(); if(!data) return;

    // Update board for this player
    const boardKey = playerNum===1?'board1':'board2';
    if(JSON.stringify(boardNums) !== JSON.stringify(data[boardKey])){
      boardNums = data[boardKey];
      populateGrid();
    }

    // Update called numbers
    calledNumbers = data.calledNumbers||[];
    calledNumbersDiv.textContent="Called Numbers: "+calledNumbers.join(', ');

    // Mark cells & highlight completed rows/columns
    cells.forEach((cell,i)=>{cell.classList.remove('marked','completed');});
    highlightCompletedLines();

    // Check bingo
    checkBingo();
  });
}

// New Game
newGameBtn.onclick=function(){
  const board1=generateBoard(); const board2=generateBoard();
  db.ref('rooms/'+roomCode).update({calledNumbers:[], board1, board2});
  bingo=false; document.getElementById('winner').textContent='';
};

// Bingo check & highlight completed rows/columns
function highlightCompletedLines(){
  const lines=[];
  for(let r=0;r<SIZE;r++) lines.push([...Array(SIZE)].map((_,c)=>r*SIZE+c));
  for(let c=0;c<SIZE;c++) lines.push([...Array(SIZE)].map((_,r)=>r*SIZE+c));

  lines.forEach(line=>{
    if(line.every(i=>calledNumbers.includes(boardNums[i]))){
      line.forEach(i=>cells[i].classList.add('completed'));
    } else {
      line.forEach(i=>{
        if(calledNumbers.includes(boardNums[i])) cells[i].classList.add('marked');
      });
    }
  });
}

function checkBingo(){
  if(bingo) return;
  const lines=[];
  for(let r=0;r<SIZE;r++) lines.push([...Array(SIZE)].map((_,c)=>r*SIZE+c));
  for(let c=0;c<SIZE;c++) lines.push([...Array(SIZE)].map((_,r)=>r*SIZE+c));
  let won=false;
  lines.forEach(line=>{if(line.every(i=>calledNumbers.includes(boardNums[i]))) won=true;});
  if(won){
    bingo=true;
    document.getElementById('winner').textContent="ðŸŽ‰ BINGO!";
    sound.currentTime=0;
    sound.play();
    confetti();
  }
}

/* CONFETTI */
function confetti(){
  const c=document.getElementById('confetti'); const ctx=c.getContext('2d'); c.width=innerWidth; c.height=innerHeight;
  const pieces=[...Array(120)].map(()=>({x:Math.random()*c.width,y:-20,r:Math.random()*6+4,v:Math.random()*3+2,col:['#f48fb1','#ce93d8','#b39ddb','#80cbc4','#a5d6a7'][Math.floor(Math.random()*5)]}));
  let frame=0;
  function draw(){ctx.clearRect(0,0,c.width,c.height);pieces.forEach(p=>{p.y+=p.v;ctx.fillStyle=p.col;ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();}); if(frame++<180)requestAnimationFrame(draw);}draw();
}
</script>
</body>
</html>
